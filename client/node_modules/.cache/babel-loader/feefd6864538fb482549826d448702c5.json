{"ast":null,"code":"import _regeneratorRuntime from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _taggedTemplateLiteral from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js\";var _templateObject;import React,{useEffect,useState}from'react';/** @jsxImportSource @emotion/react */import{css}from'@emotion/react';import SockJS from'sockjs-client';import{over}from'stompjs';import TopNavigation from'../../components/Common/TopNavigation/TopNavigation';import BottomNavigation from'../../components/Common/BottomNavigation/BottomNavigation';import colors from'../../constants/colors';import logo from'../../assets/logo2.png';import Main from'../../components/Common/Main/Main';import RoomItem from'../../components/Chat/RoomItem';import{useNavigate}from'react-router-dom';import*as ChatApi from'../../api/chat';import{jsx as _jsx}from\"@emotion/react/jsx-runtime\";import{Fragment as _Fragment}from\"@emotion/react/jsx-runtime\";import{jsxs as _jsxs}from\"@emotion/react/jsx-runtime\";var EditButton=function EditButton(){return _jsx(\"button\",{css:css(_templateObject||(_templateObject=_taggedTemplateLiteral([\"\\n\\t\\t\\t\\tbackground-color: \",\";\\n\\t\\t\\t\\tcolor: \",\";\\n\\t\\t\\t\\tborder: none;\\n\\t\\t\\t\\tfont-size: 16px;\\n\\t\\t\\t\\tfont-family: 'Bold';\\n\\t\\t\\t\\tpadding: 20px 15px 0 10px;\\n\\t\\t\\t\"])),colors.background,colors.green100),children:\"Edit\"});};var stompClient=null;var ChatList=function ChatList(){var navigate=useNavigate();var _useState=useState(null),_useState2=_slicedToArray(_useState,2),chatList=_useState2[0],setChatList=_useState2[1];// todo: 유저정보 가져와야함\nvar _useState3=useState('testId'),_useState4=_slicedToArray(_useState3,2),userId=_useState4[0],setUserId=_useState4[1];var fetchAndSetChatList=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return ChatApi.getChatRoomLists();case 3:data=_context.sent;setChatList(data);_context.next=10;break;case 7:_context.prev=7;_context.t0=_context[\"catch\"](0);console.log(_context.t0);case 10:case\"end\":return _context.stop();}}},_callee,null,[[0,7]]);}));return function fetchAndSetChatList(){return _ref.apply(this,arguments);};}();var onMessageReceived=function onMessageReceived(payload){var payloadData=JSON.parse(payload.body);console.log(payloadData);fetchAndSetChatList();};var onError=function onError(err){console.log(err);throw err;};var onConnected=function onConnected(){console.log('연결완료');stompClient.subscribe(\"/topic/chat/wait/\".concat(userId),onMessageReceived);};useEffect(function(){var fetch=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(){return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:return _context2.abrupt(\"return\",fetchAndSetChatList());case 1:case\"end\":return _context2.stop();}}},_callee2);}));return function fetch(){return _ref2.apply(this,arguments);};}();fetch();},[]);// 소켓연결\nuseEffect(function(){var Sock=new SockJS(process.env.REACT_APP_SOCKET_URI);stompClient=over(Sock);stompClient.connect({},onConnected,onError);return function(){if(stompClient.connected)stompClient.disconnect();};},[]);return _jsxs(_Fragment,{children:[_jsx(TopNavigation,{centerContent:\"\\uCC44\\uD305\",rightMenu:_jsx(EditButton,{})}),_jsx(Main,{children:chatList?chatList.map(function(chatRoom){return _jsx(RoomItem,{// todo : img 받아서 구현 필요\nimgSrc:logo,partnerName:chatRoom.partnerName,message:chatRoom.lastMessage,unreadCnt:chatRoom.unreadMsgCnt,onClickHander:function onClickHander(){return navigate('/chat/room',{state:{roomId:chatRoom.roomId,receiverId:chatRoom.partnerId}});}},chatRoom.roomId);}):// todo : 로딩컴퍼넌트로 넘겨주자\n_jsx(\"div\",{})}),_jsx(BottomNavigation,{})]});};export default ChatList;","map":{"version":3,"names":["React","useEffect","useState","css","SockJS","over","TopNavigation","BottomNavigation","colors","logo","Main","RoomItem","useNavigate","ChatApi","EditButton","background","green100","stompClient","ChatList","navigate","chatList","setChatList","userId","setUserId","fetchAndSetChatList","getChatRoomLists","data","console","log","onMessageReceived","payload","payloadData","JSON","parse","body","onError","err","onConnected","subscribe","fetch","Sock","process","env","REACT_APP_SOCKET_URI","connect","connected","disconnect","map","chatRoom","partnerName","lastMessage","unreadMsgCnt","state","roomId","receiverId","partnerId"],"sources":["/Users/singco/dev/projects/S07P12C104/client/src/pages/Chat/ChatList.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\n/** @jsxImportSource @emotion/react */\nimport { css } from '@emotion/react';\nimport SockJS from 'sockjs-client';\nimport { over } from 'stompjs';\n\nimport TopNavigation from '../../components/Common/TopNavigation/TopNavigation';\nimport BottomNavigation from '../../components/Common/BottomNavigation/BottomNavigation';\nimport colors from '../../constants/colors';\nimport logo from '../../assets/logo2.png';\nimport Main from '../../components/Common/Main/Main';\nimport RoomItem from '../../components/Chat/RoomItem';\nimport { useNavigate } from 'react-router-dom';\nimport * as ChatApi from '../../api/chat';\n\nconst EditButton = () => {\n\treturn (\n\t\t<button\n\t\t\tcss={css`\n\t\t\t\tbackground-color: ${colors.background};\n\t\t\t\tcolor: ${colors.green100};\n\t\t\t\tborder: none;\n\t\t\t\tfont-size: 16px;\n\t\t\t\tfont-family: 'Bold';\n\t\t\t\tpadding: 20px 15px 0 10px;\n\t\t\t`}\n\t\t>\n\t\t\tEdit\n\t\t</button>\n\t);\n};\n\nlet stompClient = null;\nconst ChatList = () => {\n\tconst navigate = useNavigate();\n\tconst [chatList, setChatList] = useState(null);\n\n\t// todo: 유저정보 가져와야함\n\tconst [userId, setUserId] = useState('testId');\n\tconst fetchAndSetChatList = async () => {\n\t\ttry {\n\t\t\tconst data = await ChatApi.getChatRoomLists();\n\t\t\tsetChatList(data);\n\t\t} catch (err) {\n\t\t\tconsole.log(err);\n\t\t}\n\t};\n\n\tconst onMessageReceived = payload => {\n\t\tlet payloadData = JSON.parse(payload.body);\n\t\tconsole.log(payloadData);\n\t\tfetchAndSetChatList();\n\t};\n\n\tconst onError = err => {\n\t\tconsole.log(err);\n\t\tthrow err;\n\t};\n\tconst onConnected = () => {\n\t\tconsole.log('연결완료');\n\t\tstompClient.subscribe(`/topic/chat/wait/${userId}`, onMessageReceived);\n\t};\n\n\tuseEffect(() => {\n\t\tconst fetch = async () => fetchAndSetChatList();\n\t\tfetch();\n\t}, []);\n\t// 소켓연결\n\tuseEffect(() => {\n\t\tlet Sock = new SockJS(process.env.REACT_APP_SOCKET_URI);\n\t\tstompClient = over(Sock);\n\t\tstompClient.connect({}, onConnected, onError);\n\n\t\treturn () => {\n\t\t\tif (stompClient.connected) stompClient.disconnect();\n\t\t};\n\t}, []);\n\treturn (\n\t\t<>\n\t\t\t<TopNavigation centerContent=\"채팅\" rightMenu={<EditButton />} />\n\t\t\t<Main>\n\t\t\t\t{chatList ? (\n\t\t\t\t\tchatList.map(chatRoom => (\n\t\t\t\t\t\t<RoomItem\n\t\t\t\t\t\t\tkey={chatRoom.roomId}\n\t\t\t\t\t\t\t// todo : img 받아서 구현 필요\n\t\t\t\t\t\t\timgSrc={logo}\n\t\t\t\t\t\t\tpartnerName={chatRoom.partnerName}\n\t\t\t\t\t\t\tmessage={chatRoom.lastMessage}\n\t\t\t\t\t\t\tunreadCnt={chatRoom.unreadMsgCnt}\n\t\t\t\t\t\t\tonClickHander={() =>\n\t\t\t\t\t\t\t\tnavigate('/chat/room', {\n\t\t\t\t\t\t\t\t\tstate: { roomId: chatRoom.roomId, receiverId: chatRoom.partnerId },\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t/>\n\t\t\t\t\t))\n\t\t\t\t) : (\n\t\t\t\t\t// todo : 로딩컴퍼넌트로 넘겨주자\n\t\t\t\t\t<div />\n\t\t\t\t)}\n\t\t\t</Main>\n\t\t\t<BottomNavigation />\n\t\t</>\n\t);\n};\n\nexport default ChatList;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}