{"ast":null,"code":"import _regeneratorRuntime from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/singco/dev/projects/S07P12C104/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect}from'react';import{useNavigate,useSearchParams,useLocation}from'react-router-dom';import Loading from'../../components/Common/Loading/Loading';import*as authApi from'../../api/auth';import{setRefreshToken}from'../../storage/Cookie';import API from'../../api';import{useUserDispatch}from'../../context/User/UserContext';import{setLogin,setSignUp}from'../../context/User/UserTypes';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Redirect=function Redirect(){var _useSearchParams=useSearchParams(),_useSearchParams2=_slicedToArray(_useSearchParams,1),searchParams=_useSearchParams2[0];var location=useLocation();var navigate=useNavigate();var kakaoToken=searchParams.get('code');var googleToken=new URLSearchParams(location.hash).get('id_token');var dispatch=useUserDispatch();useEffect(function(){var login=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var body,res,accessToken,userId,_userId;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!kakaoToken&&!googleToken){alert('로그인에 실패했습니다');navigate('/');}body={};if(kakaoToken){body={loginType:'Kakao',authCode:kakaoToken};}else if(googleToken){body={loginType:'Google',authCode:googleToken};}_context.prev=3;_context.next=6;return authApi.login(body);case 6:res=_context.sent;if(res.responseType==='signIn'){accessToken=res.accessToken,userId=res.userId;setRefreshToken(res.refreshToken);dispatch(setLogin(userId));API.defaults.headers.common['Authorization']=\"Bearer \".concat(accessToken);navigate('/main');}else if(res.responseType==='signUp'){_userId=res.userId;dispatch(setSignUp(_userId));navigate('/join/index');}_context.next=13;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](3);console.log(_context.t0);case 13:case\"end\":return _context.stop();}}},_callee,null,[[3,10]]);}));return function login(){return _ref.apply(this,arguments);};}();login();},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Loading,{}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uB85C\\uB529\\uC911\"})]});};export default Redirect;","map":{"version":3,"names":["React","useEffect","useNavigate","useSearchParams","useLocation","Loading","authApi","setRefreshToken","API","useUserDispatch","setLogin","setSignUp","Redirect","searchParams","location","navigate","kakaoToken","get","googleToken","URLSearchParams","hash","dispatch","login","alert","body","loginType","authCode","res","responseType","accessToken","userId","refreshToken","defaults","headers","common","console","log"],"sources":["/Users/singco/dev/projects/S07P12C104/client/src/pages/Index/Redirect.jsx"],"sourcesContent":["import React, { useEffect } from 'react';\nimport { useNavigate, useSearchParams, useLocation } from 'react-router-dom';\n\nimport Loading from '../../components/Common/Loading/Loading';\nimport * as authApi from '../../api/auth';\nimport { setRefreshToken } from '../../storage/Cookie';\nimport API from '../../api';\nimport { useUserDispatch } from '../../context/User/UserContext';\nimport { setLogin, setSignUp } from '../../context/User/UserTypes';\n\nconst Redirect = () => {\n\tconst [searchParams] = useSearchParams();\n\tconst location = useLocation();\n\tconst navigate = useNavigate();\n\tconst kakaoToken = searchParams.get('code');\n\tconst googleToken = new URLSearchParams(location.hash).get('id_token');\n\tconst dispatch = useUserDispatch();\n\n\tuseEffect(() => {\n\t\tconst login = async () => {\n\t\t\tif (!kakaoToken && !googleToken) {\n\t\t\t\talert('로그인에 실패했습니다');\n\t\t\t\tnavigate('/');\n\t\t\t}\n\t\t\tlet body = {};\n\t\t\tif (kakaoToken) {\n\t\t\t\tbody = {\n\t\t\t\t\tloginType: 'Kakao',\n\t\t\t\t\tauthCode: kakaoToken,\n\t\t\t\t};\n\t\t\t} else if (googleToken) {\n\t\t\t\tbody = {\n\t\t\t\t\tloginType: 'Google',\n\t\t\t\t\tauthCode: googleToken,\n\t\t\t\t};\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst res = await authApi.login(body);\n\t\t\t\tif (res.responseType === 'signIn') {\n\t\t\t\t\tconst { accessToken, userId } = res;\n\n\t\t\t\t\tsetRefreshToken(res.refreshToken);\n\t\t\t\t\tdispatch(setLogin(userId));\n\t\t\t\t\tAPI.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;\n\t\t\t\t\tnavigate('/main');\n\t\t\t\t} else if (res.responseType === 'signUp') {\n\t\t\t\t\tconst { userId } = res;\n\n\t\t\t\t\tdispatch(setSignUp(userId));\n\t\t\t\t\tnavigate('/join/index');\n\t\t\t\t}\n\t\t\t} catch (err) {\n\t\t\t\tconsole.log(err);\n\t\t\t}\n\t\t};\n\t\tlogin();\n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t<Loading />\n\t\t\t<span>로딩중</span>\n\t\t</>\n\t);\n};\nexport default Redirect;\n"],"mappings":"sZAAA,MAAOA,MAAP,EAAgBC,SAAhB,KAAiC,OAAjC,CACA,OAASC,WAAT,CAAsBC,eAAtB,CAAuCC,WAAvC,KAA0D,kBAA1D,CAEA,MAAOC,QAAP,KAAoB,yCAApB,CACA,MAAO,GAAKC,QAAZ,KAAyB,gBAAzB,CACA,OAASC,eAAT,KAAgC,sBAAhC,CACA,MAAOC,IAAP,KAAgB,WAAhB,CACA,OAASC,eAAT,KAAgC,gCAAhC,CACA,OAASC,QAAT,CAAmBC,SAAnB,KAAoC,8BAApC,C,6IAEA,GAAMC,SAAQ,CAAG,QAAXA,SAAW,EAAM,CACtB,qBAAuBT,eAAe,EAAtC,sDAAOU,YAAP,sBACA,GAAMC,SAAQ,CAAGV,WAAW,EAA5B,CACA,GAAMW,SAAQ,CAAGb,WAAW,EAA5B,CACA,GAAMc,WAAU,CAAGH,YAAY,CAACI,GAAb,CAAiB,MAAjB,CAAnB,CACA,GAAMC,YAAW,CAAG,GAAIC,gBAAJ,CAAoBL,QAAQ,CAACM,IAA7B,EAAmCH,GAAnC,CAAuC,UAAvC,CAApB,CACA,GAAMI,SAAQ,CAAGZ,eAAe,EAAhC,CAEAR,SAAS,CAAC,UAAM,CACf,GAAMqB,MAAK,4FAAG,6KACb,GAAI,CAACN,UAAD,EAAe,CAACE,WAApB,CAAiC,CAChCK,KAAK,CAAC,aAAD,CAAL,CACAR,QAAQ,CAAC,GAAD,CAAR,CACA,CACGS,IALS,CAKF,EALE,CAMb,GAAIR,UAAJ,CAAgB,CACfQ,IAAI,CAAG,CACNC,SAAS,CAAE,OADL,CAENC,QAAQ,CAAEV,UAFJ,CAAP,CAIA,CALD,IAKO,IAAIE,WAAJ,CAAiB,CACvBM,IAAI,CAAG,CACNC,SAAS,CAAE,QADL,CAENC,QAAQ,CAAER,WAFJ,CAAP,CAIA,CAhBY,sCAmBMZ,QAAO,CAACgB,KAAR,CAAcE,IAAd,CAnBN,QAmBNG,GAnBM,eAoBZ,GAAIA,GAAG,CAACC,YAAJ,GAAqB,QAAzB,CAAmC,CAC1BC,WAD0B,CACFF,GADE,CAC1BE,WAD0B,CACbC,MADa,CACFH,GADE,CACbG,MADa,CAGlCvB,eAAe,CAACoB,GAAG,CAACI,YAAL,CAAf,CACAV,QAAQ,CAACX,QAAQ,CAACoB,MAAD,CAAT,CAAR,CACAtB,GAAG,CAACwB,QAAJ,CAAaC,OAAb,CAAqBC,MAArB,CAA4B,eAA5B,mBAAyDL,WAAzD,EACAd,QAAQ,CAAC,OAAD,CAAR,CACA,CAPD,IAOO,IAAIY,GAAG,CAACC,YAAJ,GAAqB,QAAzB,CAAmC,CACjCE,OADiC,CACtBH,GADsB,CACjCG,MADiC,CAGzCT,QAAQ,CAACV,SAAS,CAACmB,OAAD,CAAV,CAAR,CACAf,QAAQ,CAAC,aAAD,CAAR,CACA,CAhCW,iFAkCZoB,OAAO,CAACC,GAAR,cAlCY,qEAAH,kBAALd,MAAK,0CAAX,CAqCAA,KAAK,GACL,CAvCQ,CAuCN,EAvCM,CAAT,CAyCA,mBACC,wCACC,KAAC,OAAD,IADD,cAEC,4CAFD,GADD,CAMA,CAvDD,CAwDA,cAAeV,SAAf"},"metadata":{},"sourceType":"module"}